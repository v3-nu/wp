{"version":3,"file":"time-traveling-caa58ce6.js","sources":["../../../../../packages/playground/website/demos/time-traveling.tsx"],"sourcesContent":["import React from 'react';\nimport { createRoot } from 'react-dom/client';\n\nimport { startPlaygroundWeb } from '@wp-playground/client';\nimport { login } from '@wp-playground/blueprints';\nimport {\n\tsetupPlaygroundSync,\n\tNoopTransport,\n\tloggerMiddleware,\n} from '@wp-playground/sync';\nimport type { TransportEnvelope, SyncMiddleware } from '@wp-playground/sync';\nimport { getRemoteUrl } from '../src/lib/config';\n\nconst clientId = 'time-traveling';\n\nexport async function restartDemo(initialJournal: TransportEnvelope[] = []) {\n\tconst autoincrementOffset = Math.round((1 + Math.random()) * 1_000_000);\n\tconsole.log({ autoincrementOffset });\n\tconst iframe = document.getElementById('wp') as HTMLIFrameElement;\n\tconst playground = await startPlaygroundWeb({\n\t\tiframe,\n\t\tremoteUrl: getRemoteUrl().toString(),\n\t});\n\tconst transport = new NoopTransport();\n\tawait setupPlaygroundSync(playground, {\n\t\tautoincrementOffset,\n\t\ttransport,\n\t\tmiddlewares: [loggerMiddleware(clientId), timeTravellingMiddleware],\n\t});\n\tinitialJournal.forEach((envelope) => transport.injectChanges(envelope));\n\n\tawait login(playground, { username: 'admin', password: 'password' });\n\tawait playground.goTo('/');\n}\n\nconst timeTravellingMiddleware: SyncMiddleware = {\n\tbeforeSend(envelopes) {\n\t\tstoreEnvelopes(envelopes);\n\t\treturn envelopes;\n\t},\n\tafterReceive(envelopes) {\n\t\t// We're in the solo mode and not receiving anything from the server.\n\t\treturn envelopes;\n\t},\n};\n\ntype EnvelopeListProps = {\n\tenvelopes: EnvelopeWithId[];\n};\nconst EnvelopeList: React.FC<EnvelopeListProps> = ({\n\tenvelopes,\n}: EnvelopeListProps) => {\n\tconst [uncheckedEnvelopes, setUncheckedEnvelopes] = React.useState<\n\t\tSet<number>\n\t>(new Set());\n\tfunction toggleEnvelope(id: number) {\n\t\tsetUncheckedEnvelopes((uncheckedEnvelopes) => {\n\t\t\tconst newSet = new Set(uncheckedEnvelopes);\n\t\t\tif (newSet.has(id)) {\n\t\t\t\tnewSet.delete(id);\n\t\t\t} else {\n\t\t\t\tnewSet.add(id);\n\t\t\t}\n\t\t\treturn newSet;\n\t\t});\n\t}\n\tfunction replay() {\n\t\tconst checkedEnvelopes = envelopes.filter(\n\t\t\t(envelope) => !uncheckedEnvelopes.has(envelope.id)\n\t\t);\n\t\tconsole.log('Replaying');\n\t\trestartDemo(checkedEnvelopes);\n\t}\n\treturn (\n\t\t<>\n\t\t\t<button type=\"button\" onClick={replay}>\n\t\t\t\tReplay selected\n\t\t\t</button>\n\t\t\t<ul>\n\t\t\t\t{[...envelopes].reverse().map((envelope) => (\n\t\t\t\t\t<li key={envelope.id}>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t\t\t\t\tchecked={\n\t\t\t\t\t\t\t\t\t\t\t!uncheckedEnvelopes.has(envelope.id)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tonChange={() =>\n\t\t\t\t\t\t\t\t\t\t\ttoggleEnvelope(envelope.id)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t&nbsp; Batch of changes #${envelope.id}\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<h5>SQL changes</h5>\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t{envelope.sql.map((sql, idx) => (\n\t\t\t\t\t\t\t\t\t<li key={idx}>{JSON.stringify(sql)}</li>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<h5>FS changes</h5>\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t{envelope.fs.map((fs, idx) => (\n\t\t\t\t\t\t\t\t\t<li key={idx}>{JSON.stringify(fs)}</li>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</li>\n\t\t\t\t))}\n\t\t\t</ul>\n\t\t</>\n\t);\n};\n\nconst domNode = document.getElementById('logs') as any;\nconst root = createRoot(domNode);\nroot.render(<EnvelopeList envelopes={[]} />);\n\ntype EnvelopeWithId = TransportEnvelope & { id: number };\nconst storedEnvelopes: EnvelopeWithId[] = [];\nfunction storeEnvelopes(envelope: TransportEnvelope) {\n\tif (!envelope.sql.length && !envelope.fs.length) return;\n\tstoredEnvelopes.push({ ...envelope, id: storedEnvelopes.length });\n\troot.render(<EnvelopeList envelopes={storedEnvelopes} />);\n}\n"],"names":["clientId","restartDemo","initialJournal","autoincrementOffset","iframe","playground","startPlaygroundWeb","getRemoteUrl","transport","NoopTransport","setupPlaygroundSync","loggerMiddleware","timeTravellingMiddleware","envelope","login","envelopes","storeEnvelopes","EnvelopeList","uncheckedEnvelopes","setUncheckedEnvelopes","React","toggleEnvelope","id","newSet","replay","checkedEnvelopes","jsxs","Fragment","jsx","sql","idx","fs","domNode","root","createRoot","storedEnvelopes"],"mappings":"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"}