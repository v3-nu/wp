{"version":3,"file":"builder-c80f1f9b.js","sources":["../../../../../packages/playground/website/builder/builder.ts"],"sourcesContent":["// @ts-nocheck -- This is a minimal conversion from JS to TS for build purposes.\n// @TODO: Make this TS checked\nimport { startPlaygroundWeb } from '@wp-playground/client';\n// eslint-disable-next-line @nx/enforce-module-boundaries\nimport schema from '../../blueprints/public/blueprint-schema.json';\n// @ts-ignore\nimport { corsProxyUrl } from 'virtual:cors-proxy-url';\n\nconst deref = (obj, root) => {\n\tif (!obj || typeof obj !== 'object' || !('$ref' in obj)) {\n\t\treturn obj;\n\t}\n\n\tconst path = obj['$ref'].substr(2).split('/');\n\tlet node = root;\n\n\tfor (const p of path) {\n\t\tif (!(p in node)) {\n\t\t\tthrow new Error(`Invalid reference: \"${obj['$ref']}\"`);\n\t\t}\n\t\tnode = node[p];\n\t}\n\n\treturn { ...obj, ...node };\n};\n\nconst reader = Symbol('reader');\n\nconst getSchemaReader = (schema, root = null) => {\n\tif (schema[reader]) {\n\t\treturn schema[reader];\n\t}\n\n\tif (!root) {\n\t\troot = schema;\n\t}\n\n\tconst proxy = new Proxy(schema, {\n\t\tget: (target, key, receiver) => {\n\t\t\tconst val = Reflect.get(target, key, receiver);\n\t\t\tif (val && typeof val === 'object') {\n\t\t\t\treturn getSchemaReader(deref(val, root), root);\n\t\t\t}\n\t\t\treturn val;\n\t\t},\n\t});\n\n\tschema[reader] = proxy;\n\n\treturn proxy;\n};\n\nconst getPrevKeys = (editor, { column, row }) => {\n\tconst content = editor.getValue();\n\tconst lines = content.split('\\n');\n\tconst line = String(lines[row]);\n\tconst colon = line.indexOf(':');\n\n\tconst path = [];\n\n\tif (colon > -1 && column > colon) {\n\t\tconst openQuote = line.indexOf('\"');\n\t\tconst closeQuote = line.indexOf('\"', 1 + openQuote);\n\t\tpath.push(line.substring(1 + openQuote, closeQuote));\n\t}\n\n\tlet indent = 0;\n\n\twhile (line[indent] === ' ' || line[indent] === '\\t') {\n\t\tindent++;\n\t}\n\n\tlet checkRow = -1 + row;\n\n\twhile (checkRow >= 0) {\n\t\tconst openQuote = lines[checkRow].indexOf('\"');\n\t\tconst closeQuote = lines[checkRow].indexOf('\"', 1 + openQuote);\n\t\tif (openQuote > -1 && openQuote < indent) {\n\t\t\tpath.push(lines[checkRow].substring(1 + openQuote, closeQuote));\n\t\t\tindent = openQuote;\n\t\t}\n\t\tcheckRow--;\n\t}\n\n\treturn path;\n};\n\nconst getLastOfType = (editor, type, { column, row }, skip = 0) => {\n\tconst content = editor.getValue();\n\tconst lines = content.split('\\n');\n\n\tlet checkRow = -1 + row;\n\n\twhile (checkRow >= 0) {\n\t\tconst openBracket = lines[checkRow].indexOf('{');\n\n\t\tif (openBracket > -1) {\n\t\t\tif (--skip < 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tcheckRow--;\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet indent = 0;\n\n\t\twhile (\n\t\t\tlines[checkRow][indent] === ' ' ||\n\t\t\tlines[checkRow][indent] === '\\t'\n\t\t) {\n\t\t\tindent++;\n\t\t}\n\n\t\tconst openQuote = lines[checkRow].indexOf('\"');\n\t\tconst closeQuote = lines[checkRow].indexOf('\"', 1 + openQuote);\n\t\tconst openVQuote = lines[checkRow].indexOf('\"', 1 + closeQuote);\n\t\tconst closeVQuote = lines[checkRow].indexOf('\"', 1 + openVQuote);\n\n\t\tif (openQuote > -1 && openQuote === indent) {\n\t\t\tconst checkType = lines[checkRow].substring(\n\t\t\t\t1 + openQuote,\n\t\t\t\tcloseQuote\n\t\t\t);\n\t\t\tif (type === checkType) {\n\t\t\t\treturn lines[checkRow].substring(1 + openVQuote, closeVQuote);\n\t\t\t}\n\t\t}\n\n\t\tcheckRow--;\n\t}\n\n\treturn null;\n};\n\nconst getPrevSiblings = (editor, { column, row }) => {\n\tconst content = editor.getValue();\n\tconst lines = content.split('\\n');\n\n\tlet checkRow = -1 + row;\n\tlet indent = 0;\n\n\twhile (lines[row][indent] === ' ' || lines[row][indent] === '\\t') {\n\t\tindent++;\n\t}\n\n\tconst siblings = [];\n\n\twhile (checkRow >= 0) {\n\t\tconst openBracket = lines[checkRow].indexOf('{');\n\n\t\tif (openBracket > -1 && openBracket < indent) {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst openQuote = lines[checkRow].indexOf('\"');\n\t\tconst closeQuote = lines[checkRow].indexOf('\"', 1 + openQuote);\n\n\t\tif (openQuote > -1 && openQuote === indent) {\n\t\t\tsiblings.push(lines[checkRow].substring(1 + openQuote, closeQuote));\n\t\t}\n\n\t\tcheckRow--;\n\t}\n\n\treturn siblings;\n};\n\nconst getStepProperties = async (stepType) => {\n\tconst reader = getSchemaReader(schema);\n\treturn reader.definitions.StepDefinition.oneOf\n\t\t.filter((s) => s.properties.step['const'] === stepType)\n\t\t.map((s) => s.properties)\n\t\t.flat()\n\t\t.pop();\n};\n\nconst completeStepProperty = async (stepType, prefix) => {\n\treturn schema.definitions.StepDefinition.oneOf\n\t\t.filter((s) => s.properties.step['const'] === stepType)\n\t\t.map((s) => Object.keys(s.properties))\n\t\t.flat()\n\t\t.filter((s) => s.substr(0, prefix.length) === prefix)\n\t\t.filter((s) => !['step', 'progress'].includes(s));\n};\n\nconst getStepSubProperties = async (stepType, resType, property) => {\n\tconst reader = getSchemaReader(schema);\n\treturn reader.definitions.StepDefinition.oneOf\n\t\t.filter((s) => s.properties.step['const'] === stepType)\n\t\t.map((s) => {\n\t\t\treturn s.properties[property].anyOf;\n\t\t})\n\t\t.flat()\n\t\t.filter((s) => !resType || s.properties.resource.const === resType)\n\t\t.map((s) => s.properties)\n\t\t.flat()\n\t\t.pop();\n};\n\nconst completeStepSubProperty = async (\n\tstepType,\n\tresType,\n\tproperty,\n\tsubKey,\n\tprefix\n) => {\n\tif (!resType && !subKey) {\n\t\treturn ['resource'];\n\t}\n\tconst reader = getSchemaReader(schema);\n\treturn reader.definitions.StepDefinition.oneOf\n\t\t.filter((s) => s.properties.step['const'] === stepType)\n\t\t.map((s) => {\n\t\t\treturn s.properties[property].anyOf;\n\t\t})\n\t\t.flat()\n\t\t.filter((s) => !resType || s.properties.resource.const === resType)\n\t\t.map((s) => {\n\t\t\tif (subKey === null) {\n\t\t\t\treturn Object.keys(s.properties);\n\t\t\t}\n\t\t\treturn s.properties.resource.const;\n\t\t})\n\t\t.flat()\n\t\t.filter((s) => !['resource'].includes(s));\n};\n\nconst completeStep = async (prefix) => {\n\tconst reader = getSchemaReader(schema);\n\treturn reader.definitions.StepDefinition.oneOf\n\t\t.map((s) => s.properties.step['const'])\n\t\t.filter((s) => s.substr(0, prefix.length) === prefix);\n};\n\nconst completePhpVersion = async (prefix) => {\n\tconst reader = getSchemaReader(schema);\n\treturn reader.definitions.SupportedPHPVersion.enum.filter(\n\t\t(s) => s.substr(0, prefix.length) === prefix\n\t);\n};\n\nconst completeRootKey = async (prefix) => {\n\tconst reader = getSchemaReader(schema);\n\treturn Object.keys(reader.definitions.Blueprint.properties).filter(\n\t\t(s) => s[0] !== '$' && s.substr(0, prefix.length) === prefix\n\t);\n};\n\nconst completeFeature = async (prefix) => {\n\tconst reader = getSchemaReader(schema);\n\treturn Object.keys(\n\t\treader.definitions.Blueprint.properties.features.properties\n\t).filter((s) => s[0] !== '$' && s.substr(0, prefix.length) === prefix);\n};\n\nlet debounce = null;\n\nconst getCompletions = async (editor, session, pos, prefix, callback) => {\n\tconst list = [];\n\tconst prevKey = getPrevKeys(editor, pos);\n\n\tconst content = editor.getValue();\n\tconst lines = content.split('\\n');\n\tconst line = String(lines[pos.row]);\n\tconst colon = line.indexOf(':');\n\n\tconst { row, column } = pos;\n\n\tconst qA =\n\t\t!lines[row][-1 + column] || lines[row][-1 + column] === ' ' ? '\"' : '';\n\tconst qB = !lines[row][column] || lines[row][column] === ' ' ? '\"' : '';\n\n\tif (\n\t\tprevKey.length === 3 &&\n\t\tprefix.length >= 3 &&\n\t\t(prevKey.join('<') === 'slug<pluginZipFile<steps' ||\n\t\t\tprevKey.join('<') === 'slug<pluginData<steps')\n\t) {\n\t\tconst wpParams = new URLSearchParams();\n\t\twpParams.set('action', 'query_plugins');\n\t\twpParams.set('request[page]', '1');\n\t\twpParams.set('request[per_page]', '200');\n\t\twpParams.set('request[locale]', 'en_US');\n\t\twpParams.set('request[search]', prefix);\n\t\twpParams.set('request[wp_version]', '6.4');\n\t\tconst proxyParams = new URLSearchParams();\n\n\t\tproxyParams.set(\n\t\t\t'url',\n\t\t\t`http://api.wordpress.org/plugins/info/1.2/?${wpParams}`\n\t\t);\n\n\t\tif (debounce) {\n\t\t\tclearTimeout(debounce);\n\t\t\tdebounce = null;\n\t\t}\n\n\t\tdocument.body.setAttribute('data-loading', true);\n\n\t\tdebounce = setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\n\t\t\t\t\t`https://playground.wordpress.net/plugin-proxy.php?${proxyParams}`\n\t\t\t\t);\n\t\t\t\tconst json = await res.json();\n\t\t\t\tjson?.plugins.forEach((p) => {\n\t\t\t\t\tconst doc = new DOMParser().parseFromString(\n\t\t\t\t\t\tp.name,\n\t\t\t\t\t\t'text/html'\n\t\t\t\t\t);\n\t\t\t\t\tconst meta = doc.documentElement.textContent;\n\t\t\t\t\tcallback(null, [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: p.slug,\n\t\t\t\t\t\t\tvalue: qA + p.slug + qB,\n\t\t\t\t\t\t\tscore: 1,\n\t\t\t\t\t\t\tmeta,\n\t\t\t\t\t\t},\n\t\t\t\t\t]);\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tdocument.body.setAttribute('data-loading', false);\n\t\t\t}\n\t\t}, 250);\n\t}\n\n\tif (\n\t\tprevKey.length === 3 &&\n\t\tprefix.length >= 3 &&\n\t\t(prevKey.join('<') === 'slug<themeData<steps' ||\n\t\t\tprevKey.join('<') === 'slug<themeZipFile<steps')\n\t) {\n\t\tconst wpParams = new URLSearchParams();\n\t\twpParams.set('action', 'query_themes');\n\t\twpParams.set('request[page]', '1');\n\t\twpParams.set('request[per_page]', '200');\n\t\twpParams.set('request[locale]', 'en_US');\n\t\twpParams.set('request[search]', prefix);\n\t\twpParams.set('request[wp_version]', '6.4');\n\t\tconst proxyParams = new URLSearchParams();\n\t\tproxyParams.set(\n\t\t\t'url',\n\t\t\t`http://api.wordpress.org/themes/info/1.2/?${wpParams}`\n\t\t);\n\n\t\tif (debounce) {\n\t\t\tclearTimeout(debounce);\n\t\t\tdebounce = null;\n\t\t}\n\n\t\tdocument.body.setAttribute('data-loading', true);\n\n\t\tdebounce = setTimeout(async () => {\n\t\t\ttry {\n\t\t\t\tconst res = await fetch(\n\t\t\t\t\t`https://playground.wordpress.net/plugin-proxy.php?${proxyParams}`\n\t\t\t\t);\n\t\t\t\tconst json = await res.json();\n\t\t\t\tjson?.themes.forEach((p) => {\n\t\t\t\t\tconst doc = new DOMParser().parseFromString(\n\t\t\t\t\t\tp.name,\n\t\t\t\t\t\t'text/html'\n\t\t\t\t\t);\n\t\t\t\t\tconst meta = doc.documentElement.textContent;\n\t\t\t\t\tcallback(null, [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: p.slug,\n\t\t\t\t\t\t\tvalue: qA + p.slug + qB,\n\t\t\t\t\t\t\tscore: 1,\n\t\t\t\t\t\t\tmeta,\n\t\t\t\t\t\t},\n\t\t\t\t\t]);\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tdocument.body.setAttribute('data-loading', false);\n\t\t\t}\n\t\t}, 250);\n\t}\n\n\tswitch (prevKey[0]) {\n\t\tcase 'preferredVersions': {\n\t\t\tconst used = await getPrevSiblings(editor, pos);\n\t\t\tlist.push(...['wp', 'php'].filter((s) => !used.includes(s)));\n\t\t\tbreak;\n\t\t}\n\n\t\tcase 'wp':\n\t\t\tlist.push('latest');\n\t\t\tbreak;\n\n\t\tcase 'php':\n\t\t\tlist.push(...(await completePhpVersion(prefix)));\n\t\t\tbreak;\n\n\t\tcase 'steps':\n\t\t\t{\n\t\t\t\tconst used = await getPrevSiblings(editor, pos);\n\t\t\t\tconst stepType = getLastOfType(editor, 'step', pos);\n\t\t\t\tif (stepType) {\n\t\t\t\t\tconst suggestions = await completeStepProperty(\n\t\t\t\t\t\tstepType,\n\t\t\t\t\t\tprefix\n\t\t\t\t\t);\n\t\t\t\t\tlist.push(...suggestions.filter((s) => !used.includes(s)));\n\t\t\t\t} else {\n\t\t\t\t\tlist.push('step');\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'step':\n\t\t\tlist.push(...(await completeStep(prefix)));\n\t\t\tbreak;\n\n\t\tcase 'features':\n\t\t\tlist.push(...(await completeFeature(prefix)));\n\t\t\tbreak;\n\n\t\tcase undefined:\n\t\t\tlist.push(...(await completeRootKey(prefix)));\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (prevKey[-1 + prevKey.length]) {\n\t\t\t\tcase 'steps':\n\t\t\t\t\t{\n\t\t\t\t\t\tconst stepType = getLastOfType(editor, 'step', pos, 1);\n\t\t\t\t\t\tconst resType = getLastOfType(\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\t'resource',\n\t\t\t\t\t\t\tpos,\n\t\t\t\t\t\t\t1\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (prevKey.length === 2) {\n\t\t\t\t\t\t\tif (colon === -1) {\n\t\t\t\t\t\t\t\tconst used = await getPrevSiblings(editor, pos);\n\t\t\t\t\t\t\t\tconst suggestions =\n\t\t\t\t\t\t\t\t\tawait completeStepSubProperty(\n\t\t\t\t\t\t\t\t\t\tstepType,\n\t\t\t\t\t\t\t\t\t\tresType,\n\t\t\t\t\t\t\t\t\t\tprevKey[-2 + prevKey.length],\n\t\t\t\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t\t\t\tprefix\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tlist.push(\n\t\t\t\t\t\t\t\t\t...suggestions.filter(\n\t\t\t\t\t\t\t\t\t\t(s) => !used.includes(s)\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\tprevKey.length === 3 &&\n\t\t\t\t\t\t\tprevKey[0] === 'resource'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tlist.push(\n\t\t\t\t\t\t\t\t...(await completeStepSubProperty(\n\t\t\t\t\t\t\t\t\tstepType,\n\t\t\t\t\t\t\t\t\tresType,\n\t\t\t\t\t\t\t\t\tprevKey[-2 + prevKey.length],\n\t\t\t\t\t\t\t\t\tprevKey[0],\n\t\t\t\t\t\t\t\t\tprefix\n\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tbreak;\n\t}\n\n\tfor (const fill of list) {\n\t\tcallback(null, [\n\t\t\t{\n\t\t\t\tname: fill,\n\t\t\t\tvalue: qA + fill + qB,\n\t\t\t\tscore: 1,\n\t\t\t\tmeta: 'Blueprint Schema',\n\t\t\t},\n\t\t]);\n\t}\n};\n\nlet errorTag;\nconst showError = (error) => {\n\tconsole.error(error);\n\tif (!errorTag) {\n\t\terrorTag = document.getElementById('error-output');\n\t}\n\tconst errDoc = `<head><style>body{ color: red; font-family: monospace; } pre{ white-space: pre-wrap; } p{ margin: 0.25rem; }</style></head><body>${error}</body>`;\n\terrorTag.setAttribute('srcdoc', errDoc);\n};\nconst clearError = (error) => {\n\tif (!errorTag) {\n\t\terrorTag = document.getElementById('error-output');\n\t}\n\terrorTag.setAttribute('srcdoc', '');\n};\n\nconst formatJson = (editor, jsonObject = {}) => {\n\tconst existing = editor.getSession().getValue();\n\tconst formatted = JSON.stringify(jsonObject, null, 2) + '\\n';\n\tif (formatted !== existing) {\n\t\teditor.getSession().setValue(formatted);\n\t\tif (formatted !== existing) {\n\t\t\teditor.getSession().setValue(formatted);\n\t\t}\n\t}\n};\n\nfunction getCurrentBlueprint(editor) {\n\tconst blueprint = JSON.parse(editor.getValue());\n\tif (blueprint.features && blueprint.features.networking === false) {\n\t\tblueprint.features.networking = true;\n\t}\n\treturn blueprint;\n}\n\nlet lastRun = 0;\nconst runBlueprint = async (editor) => {\n\tconst currentRun = ++lastRun;\n\t// Trash the old iframe and create a new one\n\t// to avoid subsequent reloads conflicting with\n\t// ones potentially already in progress.\n\tconst newIframe = document.createElement('iframe');\n\tlet playgroundIframe = document.getElementById('wp-playground');\n\tplaygroundIframe.parentNode.insertBefore(newIframe, playgroundIframe);\n\tplaygroundIframe.remove();\n\tplaygroundIframe = newIframe;\n\tnewIframe.id = 'wp-playground';\n\n\ttry {\n\t\tdocument.body.setAttribute('data-starting', true);\n\t\tclearError();\n\n\t\tconst blueprintJsonObject = getCurrentBlueprint(editor);\n\t\tformatJson(editor, blueprintJsonObject);\n\n\t\tconst blueprintString = JSON.stringify(blueprintJsonObject);\n\t\twindow.location.hash = blueprintString;\n\n\t\tconst blueprintCopy = JSON.parse(blueprintString);\n\t\tawait startPlaygroundWeb({\n\t\t\tiframe: playgroundIframe,\n\t\t\tremoteUrl: `https://playground.wordpress.net/remote.html`,\n\t\t\tblueprint: blueprintCopy,\n\t\t\tcorsProxy: corsProxyUrl,\n\t\t});\n\t} catch (error) {\n\t\tif (currentRun === lastRun) {\n\t\t\tshowError(error);\n\t\t}\n\t} finally {\n\t\tif (currentRun === lastRun) {\n\t\t\tdocument.body.setAttribute('data-starting', false);\n\t\t}\n\t}\n};\n\nconst loadFromHash = (editor) => {\n\tconst hash = decodeURI(window.location.hash.substr(1));\n\ttry {\n\t\tlet json = '';\n\t\ttry {\n\t\t\tjson = JSON.parse(atob(hash));\n\t\t} catch (e) {\n\t\t\tjson = JSON.parse(hash);\n\t\t}\n\t\treturn json;\n\t} catch (error) {\n\t\tconsole.error(error);\n\t}\n};\n\nfunction onLoaded() {\n\tconst button = document.querySelector('button#run');\n\tconst newTab = document.querySelector('button#new-tab');\n\n\t// eslint-disable-next-line no-undef\n\tconst editor = ace.edit('jsontext');\n\teditor.setTheme('ace/theme/github_dark');\n\teditor.session.setMode('ace/mode/json');\n\n\t// eslint-disable-next-line no-undef\n\tconst langTools = ace.require('ace/ext/language_tools');\n\n\tlangTools.setCompleters([]);\n\n\tlangTools.addCompleter({ triggerCharacters: ['\"'], getCompletions });\n\n\teditor.setOptions({\n\t\tenableBasicAutocompletion: true,\n\t\tenableLiveAutocompletion: true,\n\t\tenableSnippets: true,\n\t\tuseSoftTabs: true,\n\t\ttabSize: 2,\n\t});\n\n\teditor.getSession().on('change', async (event) => {\n\t\tif (event.action !== 'insert') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst content = editor.getValue();\n\t\tconst lines = content.split('\\n');\n\n\t\tif (\n\t\t\tevent.start.row === event.end.row &&\n\t\t\t1 < Math.abs(event.start.column - event.end.column)\n\t\t) {\n\t\t\tif (lines[event.end.row][event.end.column] === '\"') {\n\t\t\t\teditor.moveCursorTo(event.end.row, event.end.column + 1);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (lines[event.end.row][event.end.column]) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst inserted = event.lines.join('\\n');\n\t\tconst prevKey = getPrevKeys(editor, event.end);\n\n\t\tif (inserted.length > 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (inserted === ':') {\n\t\t\tconst colon = lines[event.start.row].indexOf(':');\n\t\t\tif (colon > -1 && colon < event.start.column) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (prevKey.length === 1 && prevKey[0] === 'landingPage') {\n\t\t\t\teditor\n\t\t\t\t\t.getSession()\n\t\t\t\t\t.insert(\n\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t' \"\"'\n\t\t\t\t\t);\n\t\t\t\teditor.moveCursorTo(event.end.row, 1 + event.end.column);\n\t\t\t}\n\n\t\t\tif (prevKey.length === 1 && prevKey[0] === 'preferredVersions') {\n\t\t\t\teditor\n\t\t\t\t\t.getSession()\n\t\t\t\t\t.insert(\n\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t' {}'\n\t\t\t\t\t);\n\t\t\t\teditor.moveCursorTo(event.end.row, 1 + event.end.column);\n\t\t\t}\n\n\t\t\tif (prevKey.length === 2 && prevKey[1] === 'preferredVersions') {\n\t\t\t\teditor\n\t\t\t\t\t.getSession()\n\t\t\t\t\t.insert(\n\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t' \"\"'\n\t\t\t\t\t);\n\t\t\t\teditor.moveCursorTo(event.end.row, 1 + event.end.column);\n\t\t\t\tsetTimeout(() => editor.execCommand('startAutocomplete'), 0);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tprevKey.length === 1 &&\n\t\t\t\t(prevKey[0] === 'steps' || prevKey[0] === 'features')\n\t\t\t) {\n\t\t\t\teditor\n\t\t\t\t\t.getSession()\n\t\t\t\t\t.insert(\n\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t' {}'\n\t\t\t\t\t);\n\t\t\t\teditor.moveCursorTo(event.end.row, 1 + event.end.column);\n\t\t\t}\n\n\t\t\tif (prevKey.length === 3 && prevKey[2] === 'steps') {\n\t\t\t\tconst stepType = getLastOfType(editor, 'step', event.end, 1);\n\t\t\t\tconst resType = getLastOfType(editor, 'resource', event.end);\n\t\t\t\tconst subProps = await getStepSubProperties(\n\t\t\t\t\tstepType,\n\t\t\t\t\tresType,\n\t\t\t\t\tprevKey[1]\n\t\t\t\t);\n\t\t\t\tconst subProp = subProps[prevKey[0]];\n\n\t\t\t\tif (subProp?.type === 'string') {\n\t\t\t\t\teditor\n\t\t\t\t\t\t.getSession()\n\t\t\t\t\t\t.insert(\n\t\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t\t' \"\"'\n\t\t\t\t\t\t);\n\t\t\t\t\teditor.moveCursorTo(event.end.row, 2 + event.end.column);\n\t\t\t\t\teditor.execCommand('startAutocomplete');\n\t\t\t\t} else if (subProp?.type === 'object') {\n\t\t\t\t\teditor\n\t\t\t\t\t\t.getSession()\n\t\t\t\t\t\t.insert(\n\t\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t\t' {}'\n\t\t\t\t\t\t);\n\t\t\t\t\teditor.moveCursorTo(event.end.row, 2 + event.end.column);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prevKey.length === 2 && prevKey[1] === 'steps') {\n\t\t\t\tconst stepType = await getLastOfType(editor, 'step', event.end);\n\t\t\t\tconst properties = await getStepProperties(stepType);\n\t\t\t\tconst property = properties[prevKey[0]] ?? null;\n\t\t\t\tconst propType = property.type ?? null;\n\t\t\t\tconst propRef = property['$ref'];\n\n\t\t\t\tif (propType === 'string') {\n\t\t\t\t\teditor\n\t\t\t\t\t\t.getSession()\n\t\t\t\t\t\t.insert(\n\t\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t\t' \"\"'\n\t\t\t\t\t\t);\n\t\t\t\t\teditor.moveCursorTo(event.end.row, 2 + event.end.column);\n\t\t\t\t} else if (propRef === '#/definitions/FileReference') {\n\t\t\t\t\teditor\n\t\t\t\t\t\t.getSession()\n\t\t\t\t\t\t.insert(\n\t\t\t\t\t\t\t{ row: event.end.row, column: event.end.column },\n\t\t\t\t\t\t\t' {}'\n\t\t\t\t\t\t);\n\t\t\t\t\teditor.moveCursorTo(event.end.row, 2 + event.end.column);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (inserted === '[') {\n\t\t\teditor\n\t\t\t\t.getSession()\n\t\t\t\t.insert(\n\t\t\t\t\t{ row: event.end.row, column: event.start.column + 1 },\n\t\t\t\t\t']'\n\t\t\t\t);\n\t\t\treturn;\n\t\t} else if (inserted === '{') {\n\t\t\teditor\n\t\t\t\t.getSession()\n\t\t\t\t.insert(\n\t\t\t\t\t{ row: event.end.row, column: event.start.column + 1 },\n\t\t\t\t\t'}'\n\t\t\t\t);\n\t\t\treturn;\n\t\t}\n\t});\n\n\tbutton.addEventListener('click', () => {\n\t\ttry {\n\t\t\tclearError();\n\t\t\trunBlueprint(editor);\n\t\t} catch (error) {\n\t\t\tshowError(error);\n\t\t}\n\t});\n\n\tlet prevWin;\n\n\tnewTab.addEventListener('click', () => {\n\t\trunBlueprint(editor);\n\t\tconst query = new URLSearchParams();\n\n\t\tquery.set('mode', 'seamless');\n\t\tconst url =\n\t\t\t`https://playground.wordpress.net/?${query}#` +\n\t\t\tJSON.stringify(getCurrentBlueprint(editor));\n\t\tif (prevWin) {\n\t\t\tprevWin.close();\n\t\t}\n\t\tprevWin = window.open(url, '_blank');\n\t});\n\n\tinitializeBlueprint().then((blueprint) => {\n\t\tformatJson(editor, blueprint);\n\t\trunBlueprint(editor);\n\t});\n\n\teditor.commands.addCommand({\n\t\tname: 'Run Blueprint',\n\t\tbindKey: {\n\t\t\twin: 'Ctrl-Enter|Ctrl-S',\n\t\t\tmac: 'Command-Enter|Command-S',\n\t\t},\n\t\texec: (editor) => runBlueprint(editor),\n\t\treadOnly: false,\n\t});\n\n\tconst save = document.querySelector('button#save');\n\tconst open = document.querySelector('button#open');\n\n\tconst saveMethod = () => {\n\t\tconst dataUri = `data:application/json;base64,${btoa(\n\t\t\tJSON.stringify(JSON.parse(editor.getValue()), null, 2)\n\t\t)}`;\n\t\tconst link = document.createElement('a');\n\t\tlink.setAttribute('href', dataUri);\n\t\tlink.setAttribute(\n\t\t\t'download',\n\t\t\t`blueprint-${new Date().toISOString()}.json`\n\t\t);\n\t\tlink.click();\n\t};\n\n\tconst openMethod = () => {\n\t\tconst input = document.createElement('input');\n\t\tinput.setAttribute('type', 'file');\n\t\tinput.addEventListener('change', (event) => {\n\t\t\t[...input.files].forEach((f) => {\n\t\t\t\tconst reader = new FileReader();\n\t\t\t\treader.addEventListener('load', () => {\n\t\t\t\t\teditor.setValue(\n\t\t\t\t\t\tJSON.stringify(JSON.parse(reader.result), null, 2)\n\t\t\t\t\t);\n\t\t\t\t\teditor.moveCursorTo(0, 0);\n\t\t\t\t\trunBlueprint(editor);\n\t\t\t\t});\n\t\t\t\treader.readAsText(f);\n\t\t\t});\n\t\t});\n\t\tinput.click();\n\t};\n\n\tsave.addEventListener('click', saveMethod);\n\topen.addEventListener('click', openMethod);\n\n\teditor.commands.addCommand({\n\t\tname: 'Run Blueprint',\n\t\tbindKey: {\n\t\t\twin: 'Ctrl-S',\n\t\t\tmac: 'Command-S',\n\t\t},\n\t\texec: (editor) => runBlueprint(editor),\n\t\treadOnly: false,\n\t});\n}\n\nconst defaultBlueprint = {\n\tlandingPage: '/wp-admin/',\n\tpreferredVersions: {\n\t\tphp: '7.4',\n\t\twp: '5.9',\n\t},\n\tsteps: [\n\t\t{\n\t\t\tstep: 'login',\n\t\t\tusername: 'admin',\n\t\t},\n\t],\n};\n\nasync function initializeBlueprint() {\n\tif (window.location.hash) {\n\t\treturn loadFromHash();\n\t}\n\n\tconst urlParams = new URLSearchParams(window.location.search);\n\tif (urlParams.has('blueprint-url')) {\n\t\ttry {\n\t\t\tconst blueprintUrl = new URL(urlParams.get('blueprint-url'));\n\t\t\tif (blueprintUrl.hostname === 'github.com') {\n\t\t\t\tblueprintUrl.pathname = blueprintUrl.pathname.replace(\n\t\t\t\t\t/^\\/([^/]+)\\/([^/]+)\\/blob/,\n\t\t\t\t\t'/$1/$2/'\n\t\t\t\t);\n\t\t\t\tblueprintUrl.hostname = 'raw.githubusercontent.com';\n\t\t\t}\n\t\t\tconsole.log('blueprintUrl.toString()', blueprintUrl.toString());\n\t\t\tconst response = await fetch(blueprintUrl.toString());\n\t\t\treturn await response.json();\n\t\t} catch (error) {\n\t\t\tshowError(error);\n\t\t\treturn defaultBlueprint;\n\t\t}\n\t}\n\n\treturn defaultBlueprint;\n}\n\nif (document.readyState !== 'loading') {\n\tonLoaded();\n} else {\n\tdocument.addEventListener('DOMContentLoaded', onLoaded);\n}\n"],"names":["deref","obj","root","path","node","p","reader","getSchemaReader","schema","proxy","target","key","receiver","val","getPrevKeys","editor","column","row","lines","line","colon","openQuote","closeQuote","indent","checkRow","getLastOfType","type","skip","openVQuote","closeVQuote","checkType","getPrevSiblings","siblings","openBracket","getStepProperties","stepType","s","completeStepProperty","prefix","getStepSubProperties","resType","property","completeStepSubProperty","subKey","completeStep","completePhpVersion","completeRootKey","completeFeature","debounce","getCompletions","session","pos","callback","list","prevKey","qA","qB","wpParams","proxyParams","meta","used","suggestions","fill","errorTag","showError","error","errDoc","clearError","formatJson","jsonObject","existing","formatted","getCurrentBlueprint","blueprint","lastRun","runBlueprint","currentRun","newIframe","playgroundIframe","blueprintJsonObject","blueprintString","blueprintCopy","startPlaygroundWeb","corsProxyUrl","loadFromHash","hash","json","onLoaded","button","newTab","langTools","event","inserted","subProp","propType","propRef","prevWin","query","url","initializeBlueprint","save","open","saveMethod","dataUri","link","openMethod","input","defaultBlueprint","urlParams","blueprintUrl"],"mappings":"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"}